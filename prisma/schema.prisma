generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// Note: For Vercel deployment with connection pooling (e.g., PgBouncer):
// - DATABASE_URL should point to the pooler (port 6543)
// - DIRECT_URL should point to the direct connection (port 5432)
// If not using a pooler, both can point to the same URL

// ============================================
// ENUMS
// ============================================

enum RoleType {
  ADMIN
  INSTRUCTOR
  STUDENT
  MENTOR
  CHAPTER_LEAD
  STAFF
  PARENT
}

enum CourseFormat {
  ONE_OFF
  LEVELED
  LAB
  COMMONS
  EVENT
  COMPETITION_PREP
}

enum CourseLevel {
  LEVEL_101
  LEVEL_201
  LEVEL_301
}

enum TrainingModuleType {
  WORKSHOP
  SCENARIO_PRACTICE
  CURRICULUM_REVIEW
  RESOURCE
}

enum TrainingStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETE
}

enum ApprovalStatus {
  INTERVIEW_PENDING
  TRAINING_IN_PROGRESS
  APPROVED
  PAUSED
}

enum MentorshipType {
  INSTRUCTOR
  STUDENT
}

enum MentorshipStatus {
  ACTIVE
  PAUSED
  COMPLETE
}

enum FeedbackSource {
  PARENT
  STUDENT
  PEER
}

enum EventType {
  SHOWCASE
  FESTIVAL
  COMPETITION
  WORKSHOP
  ALUMNI_EVENT
}

// New enums for Phase 1

enum PositionType {
  INSTRUCTOR
  CHAPTER_PRESIDENT
  MENTOR
  STAFF
  GLOBAL_ADMIN
}

enum ApplicationStatus {
  SUBMITTED
  UNDER_REVIEW
  INTERVIEW_SCHEDULED
  INTERVIEW_COMPLETED
  ACCEPTED
  REJECTED
  WITHDRAWN
}

enum ProgressStatus {
  BEHIND_SCHEDULE
  GETTING_STARTED
  ON_TRACK
  ABOVE_AND_BEYOND
}

enum QuestionType {
  TEXT
  TEXTAREA
  RATING_1_5
  MULTIPLE_CHOICE
}

enum ProgramType {
  PASSION_LAB
  COMPETITION_PREP
  EXPERIENCE
  SEQUENCE
}

enum AwardType {
  BRONZE_INSTRUCTOR
  SILVER_INSTRUCTOR
  GOLD_INSTRUCTOR
  BRONZE_ACHIEVEMENT
  SILVER_ACHIEVEMENT
  GOLD_ACHIEVEMENT
}

// ============================================
// CORE MODELS
// ============================================

model Chapter {
  id            String   @id @default(cuid())
  name          String
  city          String?
  region        String?
  partnerSchool String?
  programNotes  String?

  // Relations
  users          User[]
  courses        Course[]
  events         Event[]
  feedbacks      Feedback[]
  positions      Position[]
  announcements  Announcement[]
  goalTemplates  GoalTemplate[]
  marketingStats MarketingStats[]
  marketingGoals MarketingGoal[]
  chapterUpdates ChapterUpdate[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model User {
  id           String     @id @default(cuid())
  name         String
  email        String     @unique
  phone        String?
  passwordHash String
  primaryRole  RoleType
  chapterId    String?
  chapter      Chapter?   @relation(fields: [chapterId], references: [id])

  // Existing relations
  roles         UserRole[]
  courses       Course[]   @relation("InstructorCourses")
  enrollments   Enrollment[]
  trainings     TrainingAssignment[]
  approvals     InstructorApproval[]
  mentorPairs   Mentorship[] @relation("MentorLinks")
  menteePairs   Mentorship[] @relation("MenteeLinks")
  feedbackGiven Feedback[] @relation("FeedbackSource")
  feedbackFor   Feedback[] @relation("FeedbackTarget")
  awards        Award[]

  // New relations for Phase 1
  applications           Application[]
  interviewNotesAuthored InterviewNote[] @relation("InterviewNotesAuthored")
  decisionsMade          Decision[]      @relation("DecisionsMade")
  announcements          Announcement[]
  goals                  Goal[]
  progressUpdatesSubmitted ProgressUpdate[] @relation("ProgressUpdatesSubmitted")
  progressUpdatesReceived  ProgressUpdate[] @relation("ProgressUpdatesReceived")
  reflectionSubmissions  ReflectionSubmission[]
  specialProgramsLed     SpecialProgram[] @relation("ProgramsLed")
  specialProgramEnrollments SpecialProgramEnrollment[]
  alumniProfile          AlumniProfile?
  collegeAdvisor         CollegeAdvisor?
  collegeAdviseeships    CollegeAdvisorship[] @relation("CollegeAdviseeships")
  profile                UserProfile?

  // Video, Calendar, Parent, Certificate, Analytics relations
  videoProgress      VideoProgress[]
  eventRsvps         EventRsvp[]
  parentLinks        ParentStudent[] @relation("ParentLinks")
  studentLinks       ParentStudent[] @relation("StudentLinks")
  certificates       Certificate[]
  analyticsEvents    AnalyticsEvent[]
  chapterUpdates     ChapterUpdate[] @relation("ChapterUpdatesAuthored")

  // Phase 15-20 relations
  notifications              Notification[]
  notificationPreference     NotificationPreference?
  conversationParticipations ConversationParticipant[]
  messagesSent               Message[]           @relation("MessagesSent")
  attendanceRecords          AttendanceRecord[]
  attendanceSessionsCreated  AttendanceSession[] @relation("AttendanceSessionsCreated")
  resourcesUploaded          Resource[]          @relation("ResourcesUploaded")

  // Onboarding
  onboarding                 OnboardingProgress?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model UserRole {
  userId String
  role   RoleType
  user   User @relation(fields: [userId], references: [id])

  @@id([userId, role])
}

model UserProfile {
  id            String   @id @default(cuid())
  userId        String   @unique
  user          User     @relation(fields: [userId], references: [id])
  bio           String?
  avatarUrl     String?
  curriculumUrl String?
  interests     String[]
  grade         Int?
  school        String?
  parentEmail   String?
  parentPhone   String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ============================================
// COURSE & PATHWAY MODELS
// ============================================

model Course {
  id               String        @id @default(cuid())
  title            String
  description      String
  format           CourseFormat
  level            CourseLevel?
  interestArea     String
  isVirtual        Boolean       @default(false)
  chapterId        String?
  chapter          Chapter?      @relation(fields: [chapterId], references: [id])
  leadInstructorId String?
  leadInstructor   User?         @relation("InstructorCourses", fields: [leadInstructorId], references: [id])
  enrollments      Enrollment[]
  pathwaySteps     PathwayStep[]
  feedback         Feedback[]
  certificates     Certificate[]
  attendanceSessions AttendanceSession[]
  resources        Resource[]
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
}

model Pathway {
  id           String        @id @default(cuid())
  name         String
  description  String
  interestArea String
  isActive     Boolean       @default(true)
  steps        PathwayStep[]
  certificates Certificate[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

model PathwayStep {
  id        String  @id @default(cuid())
  pathwayId String
  courseId  String
  stepOrder Int
  pathway   Pathway @relation(fields: [pathwayId], references: [id])
  course    Course  @relation(fields: [courseId], references: [id])
}

model Enrollment {
  id        String   @id @default(cuid())
  userId    String
  courseId  String
  status    String   @default("ENROLLED")
  user      User     @relation(fields: [userId], references: [id])
  course    Course   @relation(fields: [courseId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ============================================
// TRAINING MODELS
// ============================================

model TrainingModule {
  id            String              @id @default(cuid())
  title         String
  description   String
  materialUrl   String?
  materialNotes String?
  type          TrainingModuleType
  required      Boolean             @default(true)
  sortOrder     Int

  // Video Integration
  videoUrl       String?
  videoProvider  VideoProvider?
  videoDuration  Int?              // Duration in seconds
  videoThumbnail String?

  assignments    TrainingAssignment[]
  videoProgress  VideoProgress[]
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
}

enum VideoProvider {
  YOUTUBE
  VIMEO
  LOOM
  CUSTOM
}

model TrainingAssignment {
  id          String         @id @default(cuid())
  userId      String
  moduleId    String
  status      TrainingStatus @default(NOT_STARTED)
  completedAt DateTime?
  user        User           @relation(fields: [userId], references: [id])
  module      TrainingModule @relation(fields: [moduleId], references: [id])
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
}

model VideoProgress {
  id              String         @id @default(cuid())
  userId          String
  moduleId        String
  user            User           @relation(fields: [userId], references: [id])
  module          TrainingModule @relation(fields: [moduleId], references: [id])
  watchedSeconds  Int            @default(0)
  completed       Boolean        @default(false)
  lastPosition    Int            @default(0)  // Last watched position in seconds
  completedAt     DateTime?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  @@unique([userId, moduleId])
}

model InstructorApproval {
  id           String         @id @default(cuid())
  instructorId String
  status       ApprovalStatus @default(TRAINING_IN_PROGRESS)
  notes        String?
  instructor   User           @relation(fields: [instructorId], references: [id])
  levels       InstructorApprovalLevel[]
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
}

model InstructorApprovalLevel {
  id         String             @id @default(cuid())
  approvalId String
  level      CourseLevel
  approvedAt DateTime           @default(now())
  approval   InstructorApproval @relation(fields: [approvalId], references: [id])
}

// ============================================
// MENTORSHIP MODELS
// ============================================

model Mentorship {
  id        String           @id @default(cuid())
  mentorId  String
  menteeId  String
  type      MentorshipType
  status    MentorshipStatus @default(ACTIVE)
  startDate DateTime         @default(now())
  endDate   DateTime?
  notes     String?
  mentor    User             @relation("MentorLinks", fields: [mentorId], references: [id])
  mentee    User             @relation("MenteeLinks", fields: [menteeId], references: [id])
  checkIns  MentorshipCheckIn[]
}

model MentorshipCheckIn {
  id           String     @id @default(cuid())
  mentorshipId String
  notes        String
  rating       Int?
  createdAt    DateTime   @default(now())
  mentorship   Mentorship @relation(fields: [mentorshipId], references: [id])
}

// ============================================
// EVENT & FEEDBACK MODELS
// ============================================

model Event {
  id           String    @id @default(cuid())
  title        String
  description  String
  eventType    EventType
  startDate    DateTime
  endDate      DateTime
  chapterId    String?
  chapter      Chapter?  @relation(fields: [chapterId], references: [id])
  isAlumniOnly Boolean   @default(false)

  // Calendar Integration
  location     String?
  meetingUrl   String?
  calendarUid  String?   @unique @default(cuid())  // For iCal UID

  // RSVP tracking
  rsvps        EventRsvp[]
  attendanceSessions AttendanceSession[]

  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
}

model EventRsvp {
  id        String      @id @default(cuid())
  eventId   String
  event     Event       @relation(fields: [eventId], references: [id])
  userId    String
  user      User        @relation(fields: [userId], references: [id])
  status    RsvpStatus  @default(GOING)
  createdAt DateTime    @default(now())

  @@unique([eventId, userId])
}

enum RsvpStatus {
  GOING
  MAYBE
  NOT_GOING
}

model Feedback {
  id           String         @id @default(cuid())
  source       FeedbackSource
  rating       Int?
  comments     String
  courseId     String?
  instructorId String?
  chapterId    String?
  course       Course?        @relation(fields: [courseId], references: [id])
  instructor   User?          @relation("FeedbackTarget", fields: [instructorId], references: [id])
  chapter      Chapter?       @relation(fields: [chapterId], references: [id])
  authorId     String?
  author       User?          @relation("FeedbackSource", fields: [authorId], references: [id])
  createdAt    DateTime       @default(now())
}

model Award {
  id          String    @id @default(cuid())
  name        String
  description String
  type        AwardType?
  recipientId String
  awardedAt   DateTime  @default(now())
  recipient   User      @relation(fields: [recipientId], references: [id])
}

// ============================================
// APPLICATION & RECRUITMENT MODELS
// ============================================

model Position {
  id           String       @id @default(cuid())
  title        String
  type         PositionType
  description  String?
  requirements String?
  chapterId    String?
  chapter      Chapter?     @relation(fields: [chapterId], references: [id])
  isOpen       Boolean      @default(true)
  applications Application[]
  createdAt    DateTime     @default(now())
  closedAt     DateTime?
  updatedAt    DateTime     @updatedAt
}

model Application {
  id                  String            @id @default(cuid())
  positionId          String
  position            Position          @relation(fields: [positionId], references: [id])
  applicantId         String
  applicant           User              @relation(fields: [applicantId], references: [id])
  status              ApplicationStatus @default(SUBMITTED)
  resumeUrl           String?
  coverLetter         String?
  additionalMaterials String?
  interviewSlots      InterviewSlot[]
  interviewNotes      InterviewNote[]
  decision            Decision?
  submittedAt         DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
}

model InterviewSlot {
  id            String      @id @default(cuid())
  applicationId String
  application   Application @relation(fields: [applicationId], references: [id])
  scheduledAt   DateTime
  duration      Int         @default(30)
  meetingLink   String?
  isConfirmed   Boolean     @default(false)
  createdAt     DateTime    @default(now())
}

model InterviewNote {
  id            String      @id @default(cuid())
  applicationId String
  application   Application @relation(fields: [applicationId], references: [id])
  authorId      String
  author        User        @relation("InterviewNotesAuthored", fields: [authorId], references: [id])
  content       String
  rating        Int?
  createdAt     DateTime    @default(now())
}

model Decision {
  id            String      @id @default(cuid())
  applicationId String      @unique
  application   Application @relation(fields: [applicationId], references: [id])
  decidedById   String
  decidedBy     User        @relation("DecisionsMade", fields: [decidedById], references: [id])
  accepted      Boolean
  notes         String?
  decidedAt     DateTime    @default(now())
}

// ============================================
// ANNOUNCEMENTS MODEL
// ============================================

model Announcement {
  id          String     @id @default(cuid())
  title       String
  content     String
  authorId    String
  author      User       @relation(fields: [authorId], references: [id])
  targetRoles RoleType[]
  chapterId   String?
  chapter     Chapter?   @relation(fields: [chapterId], references: [id])
  publishedAt DateTime   @default(now())
  expiresAt   DateTime?
  isActive    Boolean    @default(true)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

// ============================================
// GOALS & PROGRESS MODELS (Phase 5)
// ============================================

model GoalTemplate {
  id          String    @id @default(cuid())
  title       String
  description String?
  roleType    RoleType
  chapterId   String?
  chapter     Chapter?  @relation(fields: [chapterId], references: [id])
  isActive    Boolean   @default(true)
  sortOrder   Int       @default(0)
  goals       Goal[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Goal {
  id           String           @id @default(cuid())
  templateId   String
  template     GoalTemplate     @relation(fields: [templateId], references: [id])
  userId       String
  user         User             @relation(fields: [userId], references: [id])
  targetDate   DateTime?
  timetable    String?
  progress     ProgressUpdate[]
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
}

model ProgressUpdate {
  id            String         @id @default(cuid())
  goalId        String
  goal          Goal           @relation(fields: [goalId], references: [id])
  submittedById String
  submittedBy   User           @relation("ProgressUpdatesSubmitted", fields: [submittedById], references: [id])
  forUserId     String
  forUser       User           @relation("ProgressUpdatesReceived", fields: [forUserId], references: [id])
  status        ProgressStatus
  comments      String?
  createdAt     DateTime       @default(now())
}

// ============================================
// REFLECTION FORM MODELS
// ============================================

model ReflectionForm {
  id          String               @id @default(cuid())
  title       String
  description String?
  roleType    RoleType
  questions   ReflectionQuestion[]
  submissions ReflectionSubmission[]
  isActive    Boolean              @default(true)
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt
}

model ReflectionQuestion {
  id        String       @id @default(cuid())
  formId    String
  form      ReflectionForm @relation(fields: [formId], references: [id])
  question  String
  type      QuestionType
  options   String[]
  required  Boolean      @default(true)
  sortOrder Int
  responses ReflectionResponse[]
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
}

model ReflectionSubmission {
  id          String               @id @default(cuid())
  userId      String
  user        User                 @relation(fields: [userId], references: [id])
  formId      String
  form        ReflectionForm       @relation(fields: [formId], references: [id])
  month       DateTime
  responses   ReflectionResponse[]
  submittedAt DateTime             @default(now())
}

model ReflectionResponse {
  id           String               @id @default(cuid())
  submissionId String
  submission   ReflectionSubmission @relation(fields: [submissionId], references: [id])
  questionId   String
  question     ReflectionQuestion   @relation(fields: [questionId], references: [id])
  value        String
  createdAt    DateTime             @default(now())
}

// ============================================
// SPECIAL PROGRAMMING MODELS
// ============================================

model SpecialProgram {
  id           String        @id @default(cuid())
  name         String
  description  String?
  interestArea String
  type         ProgramType
  isVirtual    Boolean       @default(true)
  isActive     Boolean       @default(true)
  leaderId     String?
  leader       User?         @relation("ProgramsLed", fields: [leaderId], references: [id])
  participants SpecialProgramEnrollment[]
  sessions     ProgramSession[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

model ProgramSession {
  id          String         @id @default(cuid())
  programId   String
  program     SpecialProgram @relation(fields: [programId], references: [id])
  title       String
  description String?
  scheduledAt DateTime
  duration    Int
  meetingLink String?
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
}

model SpecialProgramEnrollment {
  id         String         @id @default(cuid())
  programId  String
  program    SpecialProgram @relation(fields: [programId], references: [id])
  userId     String
  user       User           @relation(fields: [userId], references: [id])
  enrolledAt DateTime       @default(now())

  @@unique([programId, userId])
}

// ============================================
// ALUMNI & COLLEGE ADVISOR MODELS
// ============================================

model AlumniProfile {
  id             String   @id @default(cuid())
  userId         String   @unique
  user           User     @relation(fields: [userId], references: [id])
  graduationYear Int?
  college        String?
  major          String?
  currentRole    String?
  bio            String?
  isVisible      Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model CollegeAdvisor {
  id           String             @id @default(cuid())
  userId       String             @unique
  user         User               @relation(fields: [userId], references: [id])
  college      String
  major        String?
  availability String?
  bio          String?
  isActive     Boolean            @default(true)
  advisees     CollegeAdvisorship[]
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
}

model CollegeAdvisorship {
  id        String         @id @default(cuid())
  advisorId String
  advisor   CollegeAdvisor @relation(fields: [advisorId], references: [id])
  adviseeId String
  advisee   User           @relation("CollegeAdviseeships", fields: [adviseeId], references: [id])
  startDate DateTime       @default(now())
  endDate   DateTime?
  notes     String?

  @@unique([advisorId, adviseeId])
}

// ============================================
// CHAPTER UPDATE MODELS (for Chapter Presidents)
// ============================================

model ChapterUpdate {
  id          String     @id @default(cuid())
  chapterId   String
  chapter     Chapter    @relation(fields: [chapterId], references: [id])
  authorId    String
  author      User       @relation("ChapterUpdatesAuthored", fields: [authorId], references: [id])
  title       String
  content     String
  targetRoles RoleType[] // Which roles should see this update
  isPinned    Boolean    @default(false)
  publishedAt DateTime   @default(now())
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

// ============================================
// MARKETING MODELS (for Chapter Presidents)
// ============================================

model MarketingStats {
  id           String   @id @default(cuid())
  chapterId    String
  chapter      Chapter  @relation(fields: [chapterId], references: [id])
  month        DateTime
  socialReach  Int?
  newInquiries Int?
  enrollments  Int?
  notes        String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@unique([chapterId, month])
}

model MarketingGoal {
  id        String    @id @default(cuid())
  chapterId String
  chapter   Chapter   @relation(fields: [chapterId], references: [id])
  metric    String
  target    Int
  deadline  DateTime?
  isActive  Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

// ============================================
// PARENT PORTAL MODELS
// ============================================

model ParentStudent {
  id         String   @id @default(cuid())
  parentId   String
  parent     User     @relation("ParentLinks", fields: [parentId], references: [id])
  studentId  String
  student    User     @relation("StudentLinks", fields: [studentId], references: [id])
  relationship String @default("Parent")  // Parent, Guardian, etc.
  isPrimary  Boolean  @default(true)
  createdAt  DateTime @default(now())

  @@unique([parentId, studentId])
}

// ============================================
// CERTIFICATE MODELS
// ============================================

model CertificateTemplate {
  id           String        @id @default(cuid())
  name         String
  description  String?
  type         CertificateType
  templateHtml String?       // HTML template for rendering
  isActive     Boolean       @default(true)
  certificates Certificate[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

model Certificate {
  id            String              @id @default(cuid())
  templateId    String
  template      CertificateTemplate @relation(fields: [templateId], references: [id])
  recipientId   String
  recipient     User                @relation(fields: [recipientId], references: [id])
  courseId      String?
  course        Course?             @relation(fields: [courseId], references: [id])
  pathwayId     String?
  pathway       Pathway?            @relation(fields: [pathwayId], references: [id])
  title         String
  description   String?
  issuedAt      DateTime            @default(now())
  certificateNumber String          @unique @default(cuid())
  pdfUrl        String?

  @@index([recipientId])
}

enum CertificateType {
  COURSE_COMPLETION
  PATHWAY_COMPLETION
  TRAINING_COMPLETION
  ACHIEVEMENT
  INSTRUCTOR_CERTIFICATION
}

// ============================================
// ANALYTICS MODELS
// ============================================

model AnalyticsEvent {
  id         String   @id @default(cuid())
  userId     String?
  user       User?    @relation(fields: [userId], references: [id])
  eventType  String   // page_view, course_start, video_watch, etc.
  eventData  Json?
  sessionId  String?
  userAgent  String?
  ipAddress  String?
  createdAt  DateTime @default(now())

  @@index([userId])
  @@index([eventType])
  @@index([createdAt])
}

model DailyStats {
  id              String   @id @default(cuid())
  date            DateTime @unique
  totalUsers      Int      @default(0)
  activeUsers     Int      @default(0)
  newEnrollments  Int      @default(0)
  courseCompletions Int    @default(0)
  videoWatchMinutes Int    @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

// ============================================
// NOTIFICATION MODELS (Phase 15)
// ============================================

enum NotificationType {
  ANNOUNCEMENT
  MENTOR_FEEDBACK
  GOAL_DEADLINE
  COURSE_UPDATE
  REFLECTION_REMINDER
  ATTENDANCE
  MESSAGE
  SYSTEM
}

model Notification {
  id         String           @id @default(cuid())
  userId     String
  user       User             @relation(fields: [userId], references: [id])
  type       NotificationType
  title      String
  body       String
  link       String?
  isRead     Boolean          @default(false)
  createdAt  DateTime         @default(now())

  @@index([userId, isRead])
  @@index([createdAt])
}

model NotificationPreference {
  id             String   @id @default(cuid())
  userId         String   @unique
  user           User     @relation(fields: [userId], references: [id])
  emailEnabled   Boolean  @default(true)
  inAppEnabled   Boolean  @default(true)
  announcements  Boolean  @default(true)
  mentorUpdates  Boolean  @default(true)
  goalReminders  Boolean  @default(true)
  courseUpdates   Boolean  @default(true)
  reflectionReminders Boolean @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

// ============================================
// MESSAGING MODELS (Phase 17)
// ============================================

model Conversation {
  id          String    @id @default(cuid())
  subject     String?
  isGroup     Boolean   @default(false)
  participants ConversationParticipant[]
  messages    Message[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model ConversationParticipant {
  id             String       @id @default(cuid())
  conversationId String
  conversation   Conversation @relation(fields: [conversationId], references: [id])
  userId         String
  user           User         @relation(fields: [userId], references: [id])
  lastReadAt     DateTime     @default(now())
  createdAt      DateTime     @default(now())

  @@unique([conversationId, userId])
}

model Message {
  id             String       @id @default(cuid())
  conversationId String
  conversation   Conversation @relation(fields: [conversationId], references: [id])
  senderId       String
  sender         User         @relation("MessagesSent", fields: [senderId], references: [id])
  content        String
  createdAt      DateTime     @default(now())

  @@index([conversationId, createdAt])
}

// ============================================
// ATTENDANCE MODELS (Phase 18)
// ============================================

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
  EXCUSED
}

model AttendanceSession {
  id        String   @id @default(cuid())
  courseId   String?
  course     Course?  @relation(fields: [courseId], references: [id])
  eventId    String?
  event      Event?   @relation(fields: [eventId], references: [id])
  title      String
  date       DateTime
  createdById String
  createdBy  User     @relation("AttendanceSessionsCreated", fields: [createdById], references: [id])
  records    AttendanceRecord[]
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model AttendanceRecord {
  id        String           @id @default(cuid())
  sessionId String
  session   AttendanceSession @relation(fields: [sessionId], references: [id])
  userId    String
  user      User             @relation(fields: [userId], references: [id])
  status    AttendanceStatus @default(PRESENT)
  notes     String?
  checkedInAt DateTime       @default(now())

  @@unique([sessionId, userId])
}

// ============================================
// RESOURCE MODELS (Phase 19)
// ============================================

// ============================================
// ONBOARDING MODELS
// ============================================

model OnboardingProgress {
  id               String    @id @default(cuid())
  userId           String    @unique
  user             User      @relation(fields: [userId], references: [id])
  currentStep      Int       @default(0)
  profileCompleted Boolean   @default(false)
  completedAt      DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
}

enum ResourceType {
  DOCUMENT
  SLIDE
  VIDEO_LINK
  WORKSHEET
  TEMPLATE
  OTHER
}

model Resource {
  id          String       @id @default(cuid())
  title       String
  description String?
  type        ResourceType
  url         String
  fileSize    Int?
  courseId     String?
  course      Course?      @relation(fields: [courseId], references: [id])
  uploadedById String
  uploadedBy  User         @relation("ResourcesUploaded", fields: [uploadedById], references: [id])
  isPublic    Boolean      @default(false)
  tags        String[]
  downloads   Int          @default(0)
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
}
