generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// Note: For Vercel deployment with connection pooling (e.g., PgBouncer):
// - DATABASE_URL should point to the pooler (port 6543)
// - DIRECT_URL should point to the direct connection (port 5432)
// If not using a pooler, both can point to the same URL

// ============================================
// ENUMS
// ============================================

enum RoleType {
  ADMIN
  INSTRUCTOR
  STUDENT
  MENTOR
  CHAPTER_LEAD
  STAFF
  PARENT
}

enum CourseFormat {
  ONE_OFF
  LEVELED
  LAB
  COMMONS
  EVENT
  COMPETITION_PREP
}

enum CourseLevel {
  LEVEL_101
  LEVEL_201
  LEVEL_301
}

enum TrainingModuleType {
  WORKSHOP
  SCENARIO_PRACTICE
  CURRICULUM_REVIEW
  RESOURCE
}

enum TrainingStatus {
  NOT_STARTED
  IN_PROGRESS
  COMPLETE
}

enum ApprovalStatus {
  INTERVIEW_PENDING
  TRAINING_IN_PROGRESS
  APPROVED
  PAUSED
}

enum MentorshipType {
  INSTRUCTOR
  STUDENT
}

enum MentorshipStatus {
  ACTIVE
  PAUSED
  COMPLETE
}

enum FeedbackSource {
  PARENT
  STUDENT
  PEER
}

enum EventType {
  SHOWCASE
  FESTIVAL
  COMPETITION
  WORKSHOP
  ALUMNI_EVENT
}

// New enums for Phase 1

enum PositionType {
  INSTRUCTOR
  CHAPTER_PRESIDENT
  MENTOR
  STAFF
  GLOBAL_ADMIN
}

enum ApplicationStatus {
  SUBMITTED
  UNDER_REVIEW
  INTERVIEW_SCHEDULED
  INTERVIEW_COMPLETED
  ACCEPTED
  REJECTED
  WITHDRAWN
}

enum ProgressStatus {
  BEHIND_SCHEDULE
  GETTING_STARTED
  ON_TRACK
  ABOVE_AND_BEYOND
}

enum QuestionType {
  TEXT
  TEXTAREA
  RATING_1_5
  MULTIPLE_CHOICE
}

enum ProgramType {
  PASSION_LAB
  COMPETITION_PREP
  EXPERIENCE
  SEQUENCE
}

enum AwardType {
  BRONZE_INSTRUCTOR
  SILVER_INSTRUCTOR
  GOLD_INSTRUCTOR
  BRONZE_ACHIEVEMENT
  SILVER_ACHIEVEMENT
  GOLD_ACHIEVEMENT
}

// ============================================
// CORE MODELS
// ============================================

model Chapter {
  id            String   @id @default(cuid())
  name          String
  city          String?
  region        String?
  partnerSchool String?
  programNotes  String?

  // Relations
  users          User[]
  courses        Course[]
  events         Event[]
  feedbacks      Feedback[]
  positions      Position[]
  announcements  Announcement[]
  goalTemplates  GoalTemplate[]
  marketingStats MarketingStats[]
  marketingGoals MarketingGoal[]
  chapterUpdates ChapterUpdate[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model User {
  id           String     @id @default(cuid())
  name         String
  email        String     @unique
  phone        String?
  passwordHash String
  primaryRole  RoleType
  chapterId    String?
  chapter      Chapter?   @relation(fields: [chapterId], references: [id])

  // Existing relations
  roles         UserRole[]
  courses       Course[]   @relation("InstructorCourses")
  enrollments   Enrollment[]
  trainings     TrainingAssignment[]
  approvals     InstructorApproval[]
  mentorPairs   Mentorship[] @relation("MentorLinks")
  menteePairs   Mentorship[] @relation("MenteeLinks")
  feedbackGiven Feedback[] @relation("FeedbackSource")
  feedbackFor   Feedback[] @relation("FeedbackTarget")
  awards        Award[]

  // New relations for Phase 1
  applications           Application[]
  interviewNotesAuthored InterviewNote[] @relation("InterviewNotesAuthored")
  decisionsMade          Decision[]      @relation("DecisionsMade")
  announcements          Announcement[]
  goals                  Goal[]
  progressUpdatesSubmitted ProgressUpdate[] @relation("ProgressUpdatesSubmitted")
  progressUpdatesReceived  ProgressUpdate[] @relation("ProgressUpdatesReceived")
  reflectionSubmissions  ReflectionSubmission[]
  specialProgramsLed     SpecialProgram[] @relation("ProgramsLed")
  specialProgramEnrollments SpecialProgramEnrollment[]
  alumniProfile          AlumniProfile?
  collegeAdvisor         CollegeAdvisor?
  collegeAdviseeships    CollegeAdvisorship[] @relation("CollegeAdviseeships")
  profile                UserProfile?

  // Video, Calendar, Parent, Certificate, Analytics relations
  videoProgress      VideoProgress[]
  eventRsvps         EventRsvp[]
  parentLinks        ParentStudent[] @relation("ParentLinks")
  studentLinks       ParentStudent[] @relation("StudentLinks")
  certificates       Certificate[]
  analyticsEvents    AnalyticsEvent[]
  chapterUpdates     ChapterUpdate[] @relation("ChapterUpdatesAuthored")

  // Phase 15-20 relations
  notifications              Notification[]
  notificationPreference     NotificationPreference?
  conversationParticipations ConversationParticipant[]
  messagesSent               Message[]           @relation("MessagesSent")
  attendanceRecords          AttendanceRecord[]
  attendanceSessionsCreated  AttendanceSession[] @relation("AttendanceSessionsCreated")
  resourcesUploaded          Resource[]          @relation("ResourcesUploaded")
  passwordResetTokens        PasswordResetToken[]

  // File Uploads
  uploads                    FileUpload[]

  // Lesson Plans
  lessonPlans                LessonPlan[]

  // Onboarding
  onboarding                 OnboardingProgress?

  // XP & Leveling
  xp                         Int              @default(0)
  level                      Int              @default(1)
  xpTransactions             XpTransaction[]

  // Audit & Waitlist
  auditLogs                  AuditLog[]       @relation("AuditLogsPerformed")
  waitlistEntries            WaitlistEntry[]

  // Student Feature Enhancements (Features 1-5)
  studyGroupsCreated             StudyGroup[]            @relation("StudyGroupsCreated")
  studyGroupMemberships          StudyGroupMember[]
  studyGroupMessages             StudyGroupMessage[]     @relation("StudyGroupMessagesAuthored")
  studyGroupResourcesUploaded    StudyGroupResource[]    @relation("StudyGroupResourcesUploaded")
  learningNotes                  LearningNote[]
  assignmentsCreated             Assignment[]            @relation("AssignmentsCreated")
  assignmentSubmissions          AssignmentSubmission[]  @relation("AssignmentSubmissionsSubmitted")
  assignmentSubmissionsGraded    AssignmentSubmission[]  @relation("AssignmentSubmissionsGraded")
  skillBadges                    SkillBadge[]

  // Student Feature Enhancements (Features 6-10)
  courseReviews                  CourseReview[]
  alumniQuestionsAsked           AlumniQuestion[]        @relation("AlumniQuestionsAsked")
  alumniQuestionsReceived        AlumniQuestion[]        @relation("AlumniQuestionsReceived")
  customGoals                    CustomGoal[]

  // Student Feature Enhancements (Features 11-17)
  recognitionsGiven              PeerRecognition[]       @relation("RecognitionsGiven")
  recognitionsReceived           PeerRecognition[]       @relation("RecognitionsReceived")
  portfolio                      Portfolio?
  officeHoursHosted              OfficeHours[]           @relation("OfficeHoursHosted")
  officeHoursBooked              OfficeHoursBooking[]    @relation("OfficeHoursBooked")
  resourceBookmarks              ResourceBookmark[]
  bookmarkFolders                BookmarkFolder[]

  // Instructor Features
  courseProposalsCreated         CourseProposal[]        @relation("CourseProposalsCreated")
  courseProposalsReviewed        CourseProposal[]        @relation("CourseProposalsReviewed")
  coInstructorAssignments        CourseInstructor[]      @relation("CoInstructorAssignments")
  observationsGiven              PeerObservation[]       @relation("ObservationsGiven")
  observationsReceived           PeerObservation[]       @relation("ObservationsReceived")

  // Student Features (16-17)
  competitionChecklists          CompetitionChecklist[]

  // Phase 1: Passion Discovery Relations
  passionInterests               StudentInterest[]       @relation("StudentPassionInterests")
  passionQuizResults             PassionQuizResult[]     @relation("PassionQuizResults")
  xpProfile                      StudentXP?              @relation("StudentXPProfile")
  xpTransactionHistory           XPTransaction[]         @relation("StudentXPTransactions")
  earnedBadges                   StudentBadge[]          @relation("StudentBadges")
  challengeCompletions           ChallengeCompletion[]   @relation("ChallengeCompletions")
  sessionWatchHistory            SessionWatchHistory[]   @relation("SessionWatchHistory")

  // Phase 2: Learning Infrastructure Relations
  skillProgress                  StudentSkillProgress[]  @relation("StudentSkillProgress")
  moduleWatchProgress            ModuleWatchProgress[]   @relation("ModuleWatchProgress")
  practiceLogs                   PracticeLog[]           @relation("PracticeLogs")
  skillChallengeCompletions      SkillChallengeCompletion[] @relation("SkillChallengeCompletions")
  learningStyle                  LearningStyleProfile?   @relation("LearningStyle")
  personalBests                  PersonalBest[]          @relation("PersonalBests")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model UserRole {
  userId String
  role   RoleType
  user   User @relation(fields: [userId], references: [id])

  @@id([userId, role])
}

model PasswordResetToken {
  id        String   @id @default(cuid())
  token     String   @unique
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  expiresAt DateTime
  usedAt    DateTime?
  createdAt DateTime @default(now())

  @@index([token])
  @@index([userId])
}

model UserProfile {
  id            String   @id @default(cuid())
  userId        String   @unique
  user          User     @relation(fields: [userId], references: [id])
  bio           String?
  avatarUrl     String?
  curriculumUrl String?
  interests     String[]
  grade         Int?
  school        String?
  parentEmail   String?
  parentPhone   String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ============================================
// COURSE & PATHWAY MODELS
// ============================================

model Course {
  id               String        @id @default(cuid())
  title            String
  description      String
  format           CourseFormat
  level            CourseLevel?
  interestArea     String
  isVirtual        Boolean       @default(false)
  maxEnrollment    Int?          // null = unlimited
  chapterId        String?
  chapter          Chapter?      @relation(fields: [chapterId], references: [id])
  leadInstructorId String?
  leadInstructor   User?         @relation("InstructorCourses", fields: [leadInstructorId], references: [id])
  enrollments      Enrollment[]
  waitlistEntries  WaitlistEntry[]
  pathwaySteps     PathwayStep[]
  feedback         Feedback[]
  certificates     Certificate[]
  attendanceSessions AttendanceSession[]
  resources        Resource[]
  studyGroups      StudyGroup[]
  learningNotes    LearningNote[]
  assignments      Assignment[]
  reviews          CourseReview[]
  portfolioItems   PortfolioItem[]
  proposals        CourseProposal[]
  coInstructors    CourseInstructor[]
  observations     PeerObservation[]
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
}

model Pathway {
  id           String        @id @default(cuid())
  name         String
  description  String
  interestArea String
  isActive     Boolean       @default(true)
  steps        PathwayStep[]
  certificates Certificate[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

model PathwayStep {
  id        String  @id @default(cuid())
  pathwayId String
  courseId  String
  stepOrder Int
  pathway   Pathway @relation(fields: [pathwayId], references: [id])
  course    Course  @relation(fields: [courseId], references: [id])
}

model Enrollment {
  id        String   @id @default(cuid())
  userId    String
  courseId  String
  status    String   @default("ENROLLED")
  user      User     @relation(fields: [userId], references: [id])
  course    Course   @relation(fields: [courseId], references: [id])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

// ============================================
// TRAINING MODELS
// ============================================

model TrainingModule {
  id            String              @id @default(cuid())
  title         String
  description   String
  materialUrl   String?
  materialNotes String?
  type          TrainingModuleType
  required      Boolean             @default(true)
  sortOrder     Int

  // Video Integration
  videoUrl       String?
  videoProvider  VideoProvider?
  videoDuration  Int?              // Duration in seconds
  videoThumbnail String?

  assignments    TrainingAssignment[]
  videoProgress  VideoProgress[]
  createdAt      DateTime            @default(now())
  updatedAt      DateTime            @updatedAt
}

enum VideoProvider {
  YOUTUBE
  VIMEO
  LOOM
  CUSTOM
}

model TrainingAssignment {
  id          String         @id @default(cuid())
  userId      String
  moduleId    String
  status      TrainingStatus @default(NOT_STARTED)
  completedAt DateTime?
  user        User           @relation(fields: [userId], references: [id])
  module      TrainingModule @relation(fields: [moduleId], references: [id])
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
}

model VideoProgress {
  id              String         @id @default(cuid())
  userId          String
  moduleId        String
  user            User           @relation(fields: [userId], references: [id])
  module          TrainingModule @relation(fields: [moduleId], references: [id])
  watchedSeconds  Int            @default(0)
  completed       Boolean        @default(false)
  lastPosition    Int            @default(0)  // Last watched position in seconds
  completedAt     DateTime?
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt

  @@unique([userId, moduleId])
}

model InstructorApproval {
  id           String         @id @default(cuid())
  instructorId String
  status       ApprovalStatus @default(TRAINING_IN_PROGRESS)
  notes        String?
  instructor   User           @relation(fields: [instructorId], references: [id])
  levels       InstructorApprovalLevel[]
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
}

model InstructorApprovalLevel {
  id         String             @id @default(cuid())
  approvalId String
  level      CourseLevel
  approvedAt DateTime           @default(now())
  approval   InstructorApproval @relation(fields: [approvalId], references: [id])
}

// ============================================
// MENTORSHIP MODELS
// ============================================

model Mentorship {
  id        String           @id @default(cuid())
  mentorId  String
  menteeId  String
  type      MentorshipType
  status    MentorshipStatus @default(ACTIVE)
  startDate DateTime         @default(now())
  endDate   DateTime?
  notes     String?
  mentor    User             @relation("MentorLinks", fields: [mentorId], references: [id])
  mentee    User             @relation("MenteeLinks", fields: [menteeId], references: [id])
  checkIns  MentorshipCheckIn[]
}

model MentorshipCheckIn {
  id           String     @id @default(cuid())
  mentorshipId String
  notes        String
  rating       Int?
  createdAt    DateTime   @default(now())
  mentorship   Mentorship @relation(fields: [mentorshipId], references: [id])
}

// ============================================
// EVENT & FEEDBACK MODELS
// ============================================

model Event {
  id           String    @id @default(cuid())
  title        String
  description  String
  eventType    EventType
  startDate    DateTime
  endDate      DateTime
  chapterId    String?
  chapter      Chapter?  @relation(fields: [chapterId], references: [id])
  isAlumniOnly Boolean   @default(false)

  // Calendar Integration
  location     String?
  meetingUrl   String?
  calendarUid  String?   @unique @default(cuid())  // For iCal UID

  // RSVP tracking
  rsvps        EventRsvp[]
  attendanceSessions AttendanceSession[]
  checklists   CompetitionChecklist[]

  createdAt    DateTime  @default(now())
  updatedAt    DateTime  @updatedAt
}

model EventRsvp {
  id        String      @id @default(cuid())
  eventId   String
  event     Event       @relation(fields: [eventId], references: [id])
  userId    String
  user      User        @relation(fields: [userId], references: [id])
  status    RsvpStatus  @default(GOING)
  createdAt DateTime    @default(now())

  @@unique([eventId, userId])
}

enum RsvpStatus {
  GOING
  MAYBE
  NOT_GOING
}

model Feedback {
  id           String         @id @default(cuid())
  source       FeedbackSource
  rating       Int?
  comments     String
  courseId     String?
  instructorId String?
  chapterId    String?
  course       Course?        @relation(fields: [courseId], references: [id])
  instructor   User?          @relation("FeedbackTarget", fields: [instructorId], references: [id])
  chapter      Chapter?       @relation(fields: [chapterId], references: [id])
  authorId     String?
  author       User?          @relation("FeedbackSource", fields: [authorId], references: [id])
  createdAt    DateTime       @default(now())
}

model Award {
  id          String    @id @default(cuid())
  name        String
  description String
  type        AwardType?
  recipientId String
  awardedAt   DateTime  @default(now())
  recipient   User      @relation(fields: [recipientId], references: [id])
}

// ============================================
// APPLICATION & RECRUITMENT MODELS
// ============================================

model Position {
  id           String       @id @default(cuid())
  title        String
  type         PositionType
  description  String?
  requirements String?
  chapterId    String?
  chapter      Chapter?     @relation(fields: [chapterId], references: [id])
  isOpen       Boolean      @default(true)
  applications Application[]
  createdAt    DateTime     @default(now())
  closedAt     DateTime?
  updatedAt    DateTime     @updatedAt
}

model Application {
  id                  String            @id @default(cuid())
  positionId          String
  position            Position          @relation(fields: [positionId], references: [id])
  applicantId         String
  applicant           User              @relation(fields: [applicantId], references: [id])
  status              ApplicationStatus @default(SUBMITTED)
  resumeUrl           String?
  coverLetter         String?
  additionalMaterials String?
  interviewSlots      InterviewSlot[]
  interviewNotes      InterviewNote[]
  decision            Decision?
  submittedAt         DateTime          @default(now())
  updatedAt           DateTime          @updatedAt
}

model InterviewSlot {
  id            String      @id @default(cuid())
  applicationId String
  application   Application @relation(fields: [applicationId], references: [id])
  scheduledAt   DateTime
  duration      Int         @default(30)
  meetingLink   String?
  isConfirmed   Boolean     @default(false)
  createdAt     DateTime    @default(now())
}

model InterviewNote {
  id            String      @id @default(cuid())
  applicationId String
  application   Application @relation(fields: [applicationId], references: [id])
  authorId      String
  author        User        @relation("InterviewNotesAuthored", fields: [authorId], references: [id])
  content       String
  rating        Int?
  createdAt     DateTime    @default(now())
}

model Decision {
  id            String      @id @default(cuid())
  applicationId String      @unique
  application   Application @relation(fields: [applicationId], references: [id])
  decidedById   String
  decidedBy     User        @relation("DecisionsMade", fields: [decidedById], references: [id])
  accepted      Boolean
  notes         String?
  decidedAt     DateTime    @default(now())
}

// ============================================
// ANNOUNCEMENTS MODEL
// ============================================

model Announcement {
  id                 String     @id @default(cuid())
  title              String
  content            String
  authorId           String
  author             User       @relation(fields: [authorId], references: [id])
  targetRoles        RoleType[]
  chapterId          String?
  chapter            Chapter?   @relation(fields: [chapterId], references: [id])
  publishedAt        DateTime   @default(now())
  scheduledPublishAt DateTime?  // null = publish immediately
  expiresAt          DateTime?
  isActive           Boolean    @default(true)
  createdAt          DateTime   @default(now())
  updatedAt          DateTime   @updatedAt
}

// ============================================
// GOALS & PROGRESS MODELS (Phase 5)
// ============================================

model GoalTemplate {
  id          String    @id @default(cuid())
  title       String
  description String?
  roleType    RoleType
  chapterId   String?
  chapter     Chapter?  @relation(fields: [chapterId], references: [id])
  isActive    Boolean   @default(true)
  sortOrder   Int       @default(0)
  goals       Goal[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Goal {
  id           String           @id @default(cuid())
  templateId   String
  template     GoalTemplate     @relation(fields: [templateId], references: [id])
  userId       String
  user         User             @relation(fields: [userId], references: [id])
  targetDate   DateTime?
  timetable    String?
  progress     ProgressUpdate[]
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt
}

model ProgressUpdate {
  id            String         @id @default(cuid())
  goalId        String
  goal          Goal           @relation(fields: [goalId], references: [id])
  submittedById String
  submittedBy   User           @relation("ProgressUpdatesSubmitted", fields: [submittedById], references: [id])
  forUserId     String
  forUser       User           @relation("ProgressUpdatesReceived", fields: [forUserId], references: [id])
  status        ProgressStatus
  comments      String?
  createdAt     DateTime       @default(now())
}

// ============================================
// REFLECTION FORM MODELS
// ============================================

model ReflectionForm {
  id          String               @id @default(cuid())
  title       String
  description String?
  roleType    RoleType
  questions   ReflectionQuestion[]
  submissions ReflectionSubmission[]
  isActive    Boolean              @default(true)
  createdAt   DateTime             @default(now())
  updatedAt   DateTime             @updatedAt
}

model ReflectionQuestion {
  id        String       @id @default(cuid())
  formId    String
  form      ReflectionForm @relation(fields: [formId], references: [id])
  question  String
  type      QuestionType
  options   String[]
  required  Boolean      @default(true)
  sortOrder Int
  responses ReflectionResponse[]
  createdAt DateTime     @default(now())
  updatedAt DateTime     @updatedAt
}

model ReflectionSubmission {
  id          String               @id @default(cuid())
  userId      String
  user        User                 @relation(fields: [userId], references: [id])
  formId      String
  form        ReflectionForm       @relation(fields: [formId], references: [id])
  month       DateTime
  responses   ReflectionResponse[]
  submittedAt DateTime             @default(now())
}

model ReflectionResponse {
  id           String               @id @default(cuid())
  submissionId String
  submission   ReflectionSubmission @relation(fields: [submissionId], references: [id])
  questionId   String
  question     ReflectionQuestion   @relation(fields: [questionId], references: [id])
  value        String
  createdAt    DateTime             @default(now())
}

// ============================================
// SPECIAL PROGRAMMING MODELS
// ============================================

model SpecialProgram {
  id           String        @id @default(cuid())
  name         String
  description  String?
  interestArea String
  type         ProgramType
  isVirtual    Boolean       @default(true)
  isActive     Boolean       @default(true)
  leaderId     String?
  leader       User?         @relation("ProgramsLed", fields: [leaderId], references: [id])
  participants SpecialProgramEnrollment[]
  sessions     ProgramSession[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

model ProgramSession {
  id          String         @id @default(cuid())
  programId   String
  program     SpecialProgram @relation(fields: [programId], references: [id])
  title       String
  description String?
  scheduledAt DateTime
  duration    Int
  meetingLink String?
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
}

model SpecialProgramEnrollment {
  id         String         @id @default(cuid())
  programId  String
  program    SpecialProgram @relation(fields: [programId], references: [id])
  userId     String
  user       User           @relation(fields: [userId], references: [id])
  enrolledAt DateTime       @default(now())

  @@unique([programId, userId])
}

// ============================================
// ALUMNI & COLLEGE ADVISOR MODELS
// ============================================

model AlumniProfile {
  id             String   @id @default(cuid())
  userId         String   @unique
  user           User     @relation(fields: [userId], references: [id])
  graduationYear Int?
  college        String?
  major          String?
  currentRole    String?
  bio            String?
  isVisible      Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model CollegeAdvisor {
  id           String             @id @default(cuid())
  userId       String             @unique
  user         User               @relation(fields: [userId], references: [id])
  college      String
  major        String?
  availability String?
  bio          String?
  isActive     Boolean            @default(true)
  advisees     CollegeAdvisorship[]
  createdAt    DateTime           @default(now())
  updatedAt    DateTime           @updatedAt
}

model CollegeAdvisorship {
  id        String         @id @default(cuid())
  advisorId String
  advisor   CollegeAdvisor @relation(fields: [advisorId], references: [id])
  adviseeId String
  advisee   User           @relation("CollegeAdviseeships", fields: [adviseeId], references: [id])
  startDate DateTime       @default(now())
  endDate   DateTime?
  notes     String?

  @@unique([advisorId, adviseeId])
}

// ============================================
// CHAPTER UPDATE MODELS (for Chapter Presidents)
// ============================================

model ChapterUpdate {
  id          String     @id @default(cuid())
  chapterId   String
  chapter     Chapter    @relation(fields: [chapterId], references: [id])
  authorId    String
  author      User       @relation("ChapterUpdatesAuthored", fields: [authorId], references: [id])
  title       String
  content     String
  targetRoles RoleType[] // Which roles should see this update
  isPinned    Boolean    @default(false)
  publishedAt DateTime   @default(now())
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
}

// ============================================
// MARKETING MODELS (for Chapter Presidents)
// ============================================

model MarketingStats {
  id           String   @id @default(cuid())
  chapterId    String
  chapter      Chapter  @relation(fields: [chapterId], references: [id])
  month        DateTime
  socialReach  Int?
  newInquiries Int?
  enrollments  Int?
  notes        String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@unique([chapterId, month])
}

model MarketingGoal {
  id        String    @id @default(cuid())
  chapterId String
  chapter   Chapter   @relation(fields: [chapterId], references: [id])
  metric    String
  target    Int
  deadline  DateTime?
  isActive  Boolean   @default(true)
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
}

// ============================================
// PARENT PORTAL MODELS
// ============================================

enum ParentLinkStatus {
  PENDING
  APPROVED
  REJECTED
}

model ParentStudent {
  id             String           @id @default(cuid())
  parentId       String
  parent         User             @relation("ParentLinks", fields: [parentId], references: [id])
  studentId      String
  student        User             @relation("StudentLinks", fields: [studentId], references: [id])
  relationship   String           @default("Parent")  // Parent, Guardian, etc.
  isPrimary      Boolean          @default(true)
  approvalStatus ParentLinkStatus @default(PENDING)
  reviewedAt     DateTime?
  reviewedById   String?
  createdAt      DateTime         @default(now())

  @@unique([parentId, studentId])
}

// ============================================
// CERTIFICATE MODELS
// ============================================

model CertificateTemplate {
  id           String        @id @default(cuid())
  name         String
  description  String?
  type         CertificateType
  templateHtml String?       // HTML template for rendering
  isActive     Boolean       @default(true)
  certificates Certificate[]
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
}

model Certificate {
  id            String              @id @default(cuid())
  templateId    String
  template      CertificateTemplate @relation(fields: [templateId], references: [id])
  recipientId   String
  recipient     User                @relation(fields: [recipientId], references: [id])
  courseId      String?
  course        Course?             @relation(fields: [courseId], references: [id])
  pathwayId     String?
  pathway       Pathway?            @relation(fields: [pathwayId], references: [id])
  title         String
  description   String?
  issuedAt      DateTime            @default(now())
  certificateNumber String          @unique @default(cuid())
  pdfUrl        String?

  @@index([recipientId])
}

enum CertificateType {
  COURSE_COMPLETION
  PATHWAY_COMPLETION
  TRAINING_COMPLETION
  ACHIEVEMENT
  INSTRUCTOR_CERTIFICATION
}

// ============================================
// ANALYTICS MODELS
// ============================================

model AnalyticsEvent {
  id         String   @id @default(cuid())
  userId     String?
  user       User?    @relation(fields: [userId], references: [id])
  eventType  String   // page_view, course_start, video_watch, etc.
  eventData  Json?
  sessionId  String?
  userAgent  String?
  ipAddress  String?
  createdAt  DateTime @default(now())

  @@index([userId])
  @@index([eventType])
  @@index([createdAt])
}

model DailyStats {
  id              String   @id @default(cuid())
  date            DateTime @unique
  totalUsers      Int      @default(0)
  activeUsers     Int      @default(0)
  newEnrollments  Int      @default(0)
  courseCompletions Int    @default(0)
  videoWatchMinutes Int    @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}

// ============================================
// NOTIFICATION MODELS (Phase 15)
// ============================================

enum NotificationType {
  ANNOUNCEMENT
  MENTOR_FEEDBACK
  GOAL_DEADLINE
  COURSE_UPDATE
  REFLECTION_REMINDER
  ATTENDANCE
  MESSAGE
  SYSTEM
}

model Notification {
  id         String           @id @default(cuid())
  userId     String
  user       User             @relation(fields: [userId], references: [id])
  type       NotificationType
  title      String
  body       String
  link       String?
  isRead     Boolean          @default(false)
  createdAt  DateTime         @default(now())

  @@index([userId, isRead])
  @@index([createdAt])
}

model NotificationPreference {
  id             String   @id @default(cuid())
  userId         String   @unique
  user           User     @relation(fields: [userId], references: [id])
  emailEnabled   Boolean  @default(true)
  inAppEnabled   Boolean  @default(true)
  announcements  Boolean  @default(true)
  mentorUpdates  Boolean  @default(true)
  goalReminders  Boolean  @default(true)
  courseUpdates   Boolean  @default(true)
  reflectionReminders Boolean @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

// ============================================
// MESSAGING MODELS (Phase 17)
// ============================================

model Conversation {
  id          String    @id @default(cuid())
  subject     String?
  isGroup     Boolean   @default(false)
  participants ConversationParticipant[]
  messages    Message[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model ConversationParticipant {
  id             String       @id @default(cuid())
  conversationId String
  conversation   Conversation @relation(fields: [conversationId], references: [id])
  userId         String
  user           User         @relation(fields: [userId], references: [id])
  lastReadAt     DateTime     @default(now())
  createdAt      DateTime     @default(now())

  @@unique([conversationId, userId])
}

model Message {
  id             String       @id @default(cuid())
  conversationId String
  conversation   Conversation @relation(fields: [conversationId], references: [id])
  senderId       String
  sender         User         @relation("MessagesSent", fields: [senderId], references: [id])
  content        String
  createdAt      DateTime     @default(now())

  @@index([conversationId, createdAt])
}

// ============================================
// ATTENDANCE MODELS (Phase 18)
// ============================================

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
  EXCUSED
}

model AttendanceSession {
  id        String   @id @default(cuid())
  courseId   String?
  course     Course?  @relation(fields: [courseId], references: [id])
  eventId    String?
  event      Event?   @relation(fields: [eventId], references: [id])
  title      String
  date       DateTime
  createdById String
  createdBy   User     @relation("AttendanceSessionsCreated", fields: [createdById], references: [id])
  records     AttendanceRecord[]
  selfCheckIn SelfCheckIn?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model AttendanceRecord {
  id        String           @id @default(cuid())
  sessionId String
  session   AttendanceSession @relation(fields: [sessionId], references: [id])
  userId    String
  user      User             @relation(fields: [userId], references: [id])
  status    AttendanceStatus @default(PRESENT)
  notes     String?
  checkedInAt DateTime       @default(now())

  @@unique([sessionId, userId])
}

// ============================================
// RESOURCE MODELS (Phase 19)
// ============================================

// ============================================
// ONBOARDING MODELS
// ============================================

model OnboardingProgress {
  id               String    @id @default(cuid())
  userId           String    @unique
  user             User      @relation(fields: [userId], references: [id])
  currentStep      Int       @default(0)
  profileCompleted Boolean   @default(false)
  completedAt      DateTime?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
}

// ============================================
// XP & LEVELING MODELS
// ============================================

model XpTransaction {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  amount    Int
  reason    String
  metadata  Json?
  createdAt DateTime @default(now())

  @@index([userId])
  @@index([createdAt])
}

enum ResourceType {
  DOCUMENT
  SLIDE
  VIDEO_LINK
  WORKSHEET
  TEMPLATE
  OTHER
}

model Resource {
  id          String       @id @default(cuid())
  title       String
  description String?
  type        ResourceType
  url         String
  fileSize    Int?
  courseId     String?
  course      Course?      @relation(fields: [courseId], references: [id])
  uploadedById String
  uploadedBy  User         @relation("ResourcesUploaded", fields: [uploadedById], references: [id])
  isPublic    Boolean      @default(false)
  tags        String[]
  downloads   Int          @default(0)
  bookmarks   ResourceBookmark[]
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
}

// ============================================
// FILE UPLOAD MODELS
// ============================================

enum UploadCategory {
  PROFILE_PHOTO
  ASSIGNMENT_SUBMISSION
  TRAINING_EVIDENCE
  OTHER
}

model FileUpload {
  id           String         @id @default(cuid())
  filename     String
  originalName String
  mimeType     String
  size         Int
  url          String
  category     UploadCategory
  userId       String
  user         User           @relation(fields: [userId], references: [id])
  entityId     String?
  entityType   String?
  createdAt    DateTime       @default(now())

  @@index([userId])
  @@index([category])
  @@index([entityId, entityType])
}

// ============================================
// LESSON PLAN MODELS
// ============================================

enum ActivityType {
  WARM_UP
  INSTRUCTION
  PRACTICE
  DISCUSSION
  ASSESSMENT
  BREAK
  REFLECTION
  GROUP_WORK
}

model LessonPlan {
  id           String           @id @default(cuid())
  title        String
  description  String?
  courseId      String?
  totalMinutes Int              @default(0)
  authorId     String
  author       User             @relation(fields: [authorId], references: [id])
  activities   LessonActivity[]
  isTemplate   Boolean          @default(false)
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt

  @@index([authorId])
}

model LessonActivity {
  id           String       @id @default(cuid())
  lessonPlanId String
  lessonPlan   LessonPlan   @relation(fields: [lessonPlanId], references: [id], onDelete: Cascade)
  title        String
  description  String?
  type         ActivityType
  durationMin  Int
  sortOrder    Int
  resources    String?
  notes        String?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt
}

// ============================================
// AUDIT LOG MODELS
// ============================================

enum AuditAction {
  USER_CREATED
  USER_UPDATED
  USER_DELETED
  ROLE_CHANGED
  COURSE_CREATED
  COURSE_UPDATED
  COURSE_DELETED
  ENROLLMENT_APPROVED
  ENROLLMENT_DECLINED
  PATHWAY_CREATED
  PATHWAY_UPDATED
  MODULE_CREATED
  MODULE_UPDATED
  ANNOUNCEMENT_CREATED
  ANNOUNCEMENT_UPDATED
  ANNOUNCEMENT_DELETED
  CERTIFICATE_ISSUED
  MENTORSHIP_CREATED
  MENTORSHIP_UPDATED
  EVENT_CREATED
  EVENT_UPDATED
  PARENT_LINK_APPROVED
  PARENT_LINK_REJECTED
  WAITLIST_PROMOTED
  SETTINGS_CHANGED
}

model AuditLog {
  id          String      @id @default(cuid())
  action      AuditAction
  actorId     String
  actor       User        @relation("AuditLogsPerformed", fields: [actorId], references: [id])
  targetType  String?     // e.g. "User", "Course", "Enrollment"
  targetId    String?
  description String
  metadata    Json?
  ipAddress   String?
  createdAt   DateTime    @default(now())

  @@index([actorId])
  @@index([action])
  @@index([targetType, targetId])
  @@index([createdAt])
}

// ============================================
// WAITLIST MODELS
// ============================================

enum WaitlistStatus {
  WAITING
  OFFERED
  ENROLLED
  EXPIRED
  CANCELLED
}

model WaitlistEntry {
  id         String         @id @default(cuid())
  userId     String
  user       User           @relation(fields: [userId], references: [id])
  courseId    String
  course     Course         @relation(fields: [courseId], references: [id])
  position   Int
  status     WaitlistStatus @default(WAITING)
  notifiedAt DateTime?
  expiresAt  DateTime?
  createdAt  DateTime       @default(now())
  updatedAt  DateTime       @updatedAt

  @@unique([userId, courseId])
  @@index([courseId, status])
  @@index([status])
}

// ============================================
// STUDENT FEATURE ENHANCEMENTS (Features 1-5)
// ============================================

// Feature 2: Peer Study Groups
model StudyGroup {
  id          String    @id @default(cuid())
  name        String
  description String?
  courseId    String
  course      Course    @relation(fields: [courseId], references: [id])
  createdById String
  createdBy   User      @relation("StudyGroupsCreated", fields: [createdById], references: [id])
  isActive    Boolean   @default(true)
  maxMembers  Int?
  members     StudyGroupMember[]
  messages    StudyGroupMessage[]
  resources   StudyGroupResource[]
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([courseId])
}

model StudyGroupMember {
  id        String     @id @default(cuid())
  groupId   String
  group     StudyGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  userId    String
  user      User       @relation(fields: [userId], references: [id])
  role      StudyGroupRole @default(MEMBER)
  joinedAt  DateTime   @default(now())

  @@unique([groupId, userId])
}

enum StudyGroupRole {
  CREATOR
  MODERATOR
  MEMBER
}

model StudyGroupMessage {
  id        String     @id @default(cuid())
  groupId   String
  group     StudyGroup @relation(fields: [groupId], references: [id], onDelete: Cascade)
  userId    String
  user      User       @relation("StudyGroupMessagesAuthored", fields: [userId], references: [id])
  content   String
  createdAt DateTime   @default(now())

  @@index([groupId, createdAt])
}

model StudyGroupResource {
  id          String       @id @default(cuid())
  groupId     String
  group       StudyGroup   @relation(fields: [groupId], references: [id], onDelete: Cascade)
  title       String
  description String?
  url         String
  uploadedById String
  uploadedBy  User         @relation("StudyGroupResourcesUploaded", fields: [uploadedById], references: [id])
  createdAt   DateTime     @default(now())

  @@index([groupId])
}

// Feature 3: Personal Learning Notes
model LearningNote {
  id         String   @id @default(cuid())
  userId     String
  user       User     @relation(fields: [userId], references: [id])
  courseId   String?
  course     Course?  @relation(fields: [courseId], references: [id])
  lessonTitle String?
  content    String
  isPinned   Boolean  @default(false)
  tags       String[]
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([userId, courseId])
}

// Feature 4: Assignment Submission Portal
enum AssignmentType {
  INDIVIDUAL
  GROUP
  PEER_REVIEW
}

enum SubmissionStatus {
  NOT_SUBMITTED
  SUBMITTED
  GRADED
  RETURNED
}

model Assignment {
  id          String         @id @default(cuid())
  courseId    String
  course      Course         @relation(fields: [courseId], references: [id])
  title       String
  description String
  type        AssignmentType @default(INDIVIDUAL)
  maxPoints   Int?
  dueDate     DateTime?
  allowLateSubmission Boolean @default(true)
  instructions String?
  attachmentUrl String?
  isPublished Boolean        @default(true)
  createdById String
  createdBy   User           @relation("AssignmentsCreated", fields: [createdById], references: [id])
  submissions AssignmentSubmission[]
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  @@index([courseId])
}

model AssignmentSubmission {
  id           String           @id @default(cuid())
  assignmentId String
  assignment   Assignment       @relation(fields: [assignmentId], references: [id])
  studentId    String
  student      User             @relation("AssignmentSubmissionsSubmitted", fields: [studentId], references: [id])
  status       SubmissionStatus @default(NOT_SUBMITTED)
  submissionUrl String?
  submissionText String?
  submittedAt  DateTime?
  grade        Int?
  feedback     String?
  gradedAt     DateTime?
  gradedById   String?
  gradedBy     User?            @relation("AssignmentSubmissionsGraded", fields: [gradedById], references: [id])
  createdAt    DateTime         @default(now())
  updatedAt    DateTime         @updatedAt

  @@unique([assignmentId, studentId])
  @@index([studentId])
}

// Feature 5: Skill Badge Display
model Skill {
  id          String      @id @default(cuid())
  name        String      @unique
  description String?
  category    String?
  iconUrl     String?
  badges      SkillBadge[]
  createdAt   DateTime    @default(now())
  updatedAt   DateTime    @updatedAt
}

enum BadgeLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  EXPERT
}

model SkillBadge {
  id          String     @id @default(cuid())
  skillId     String
  skill       Skill      @relation(fields: [skillId], references: [id])
  userId      String
  user        User       @relation(fields: [userId], references: [id])
  level       BadgeLevel @default(BEGINNER)
  earnedAt    DateTime   @default(now())
  evidence    String?
  isVisible   Boolean    @default(true)

  @@unique([skillId, userId])
  @@index([userId])
}

// ============================================
// STUDENT FEATURE ENHANCEMENTS (Features 6-10)
// ============================================

// Feature 7: Course Reviews
model CourseReview {
  id          String   @id @default(cuid())
  courseId    String
  course      Course   @relation(fields: [courseId], references: [id])
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  rating      Int      // 1-5 stars
  review      String?
  isAnonymous Boolean  @default(false)
  isVisible   Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([courseId, userId])
  @@index([courseId, rating])
  @@index([userId])
}

// Feature 8: Ask an Alum
model AlumniQuestion {
  id         String   @id @default(cuid())
  studentId  String
  student    User     @relation("AlumniQuestionsAsked", fields: [studentId], references: [id])
  advisorId  String?
  advisor    User?    @relation("AlumniQuestionsReceived", fields: [advisorId], references: [id])
  subject    String
  question   String
  answer     String?
  answeredAt DateTime?
  status     QuestionStatus @default(PENDING)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@index([studentId])
  @@index([advisorId])
  @@index([status])
}

enum QuestionStatus {
  PENDING
  ASSIGNED
  ANSWERED
  CLOSED
}

// Feature 9: Custom Goals
model CustomGoal {
  id          String    @id @default(cuid())
  userId      String
  user        User      @relation(fields: [userId], references: [id])
  title       String
  description String?
  category    String?
  targetDate  DateTime?
  milestones  CustomGoalMilestone[]
  progress    CustomGoalUpdate[]
  status      GoalStatus @default(ACTIVE)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  @@index([userId, status])
}

enum GoalStatus {
  ACTIVE
  COMPLETED
  PAUSED
  CANCELLED
}

model CustomGoalMilestone {
  id          String     @id @default(cuid())
  goalId      String
  goal        CustomGoal @relation(fields: [goalId], references: [id], onDelete: Cascade)
  title       String
  completed   Boolean    @default(false)
  completedAt DateTime?
  sortOrder   Int
  createdAt   DateTime   @default(now())

  @@index([goalId])
}

model CustomGoalUpdate {
  id        String     @id @default(cuid())
  goalId    String
  goal      CustomGoal @relation(fields: [goalId], references: [id], onDelete: Cascade)
  note      String
  progress  Int        // 0-100 percentage
  createdAt DateTime   @default(now())

  @@index([goalId, createdAt])
}

// Feature 10: Self Check-in (extends existing AttendanceSession)
model SelfCheckIn {
  id        String    @id @default(cuid())
  sessionId String
  session   AttendanceSession @relation(fields: [sessionId], references: [id])
  code      String    @unique  // QR code or PIN
  expiresAt DateTime
  isActive  Boolean   @default(true)
  createdAt DateTime  @default(now())

  @@index([code])
  @@index([sessionId])
}

// ============================================
// STUDENT FEATURE ENHANCEMENTS (Features 11-17)
// ============================================

// Feature 12: Peer Recognition
model PeerRecognition {
  id          String   @id @default(cuid())
  fromUserId  String
  fromUser    User     @relation("RecognitionsGiven", fields: [fromUserId], references: [id])
  toUserId    String
  toUser      User     @relation("RecognitionsReceived", fields: [toUserId], references: [id])
  message     String
  isPublic    Boolean  @default(true)
  createdAt   DateTime @default(now())

  @@index([toUserId])
  @@index([fromUserId])
  @@index([createdAt])
}

// Feature 13: Portfolio
model Portfolio {
  id        String          @id @default(cuid())
  userId    String          @unique
  user      User            @relation(fields: [userId], references: [id])
  title     String
  bio       String?
  isPublic  Boolean         @default(false)
  items     PortfolioItem[]
  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt
}

model PortfolioItem {
  id          String    @id @default(cuid())
  portfolioId String
  portfolio   Portfolio @relation(fields: [portfolioId], references: [id], onDelete: Cascade)
  type        PortfolioItemType
  title       String
  description String?
  url         String?
  imageUrl    String?
  courseId    String?
  course      Course?   @relation(fields: [courseId], references: [id])
  sortOrder   Int
  createdAt   DateTime  @default(now())

  @@index([portfolioId, sortOrder])
}

enum PortfolioItemType {
  PROJECT
  CERTIFICATE
  ASSIGNMENT
  ACHIEVEMENT
  COURSE
  OTHER
}

// Feature 14: Office Hours
model OfficeHours {
  id           String              @id @default(cuid())
  instructorId String
  instructor   User                @relation("OfficeHoursHosted", fields: [instructorId], references: [id])
  dayOfWeek    Int                 // 0-6 (Sunday-Saturday)
  startTime    String              // HH:MM format
  endTime      String              // HH:MM format
  slotDuration Int                 @default(30) // minutes
  isActive     Boolean             @default(true)
  bookings     OfficeHoursBooking[]
  createdAt    DateTime            @default(now())

  @@index([instructorId, isActive])
}

model OfficeHoursBooking {
  id            String       @id @default(cuid())
  officeHoursId String
  officeHours   OfficeHours  @relation(fields: [officeHoursId], references: [id])
  studentId     String
  student       User         @relation("OfficeHoursBooked", fields: [studentId], references: [id])
  date          DateTime
  startTime     String       // HH:MM format
  endTime       String       // HH:MM format
  topic         String?
  notes         String?
  status        BookingStatus @default(SCHEDULED)
  createdAt     DateTime     @default(now())

  @@unique([officeHoursId, date, startTime])
  @@index([studentId])
}

enum BookingStatus {
  SCHEDULED
  COMPLETED
  CANCELLED
  NO_SHOW
}

// Feature 16: Resource Bookmarks
model ResourceBookmark {
  id         String   @id @default(cuid())
  userId     String
  user       User     @relation(fields: [userId], references: [id])
  resourceId String
  resource   Resource @relation(fields: [resourceId], references: [id])
  folderId   String?
  folder     BookmarkFolder? @relation(fields: [folderId], references: [id])
  createdAt  DateTime @default(now())

  @@unique([userId, resourceId])
  @@index([userId, folderId])
}

model BookmarkFolder {
  id        String             @id @default(cuid())
  userId    String
  user      User               @relation(fields: [userId], references: [id])
  name      String
  bookmarks ResourceBookmark[]
  createdAt DateTime           @default(now())

  @@index([userId])
}

// ============================================
// INSTRUCTOR FEATURES (Bonus: Course Proposals)
// ============================================

model CourseProposal {
  id               String           @id @default(cuid())
  proposedById     String
  proposedBy       User             @relation("CourseProposalsCreated", fields: [proposedById], references: [id])
  title            String
  description      String
  format           CourseFormat
  level            CourseLevel?
  interestArea     String
  targetAudience   String?
  prerequisites    String?
  learningOutcomes String?
  resources        String?
  maxEnrollment    Int?
  status           ProposalStatus   @default(PENDING)
  reviewedById     String?
  reviewedBy       User?            @relation("CourseProposalsReviewed", fields: [reviewedById], references: [id])
  reviewNotes      String?
  reviewedAt       DateTime?
  approvedCourseId String?
  approvedCourse   Course?          @relation(fields: [approvedCourseId], references: [id])
  createdAt        DateTime         @default(now())
  updatedAt        DateTime         @updatedAt

  @@index([proposedById, status])
  @@index([status])
}

enum ProposalStatus {
  PENDING
  UNDER_REVIEW
  APPROVED
  REJECTED
  REVISION_REQUESTED
}

// ============================================
// STUDENT FEATURE: Competition Prep (Feature 17)
// ============================================

model CompetitionChecklist {
  id            String                    @id @default(cuid())
  userId        String
  user          User                      @relation(fields: [userId], references: [id])
  competitionId String?
  eventId       String?
  event         Event?                    @relation(fields: [eventId], references: [id])
  title         String
  items         CompetitionChecklistItem[]
  createdAt     DateTime                  @default(now())
  updatedAt     DateTime                  @updatedAt

  @@index([userId])
}

model CompetitionChecklistItem {
  id          String                @id @default(cuid())
  checklistId String
  checklist   CompetitionChecklist  @relation(fields: [checklistId], references: [id], onDelete: Cascade)
  title       String
  description String?
  category    ChecklistCategory     @default(PREPARATION)
  completed   Boolean               @default(false)
  completedAt DateTime?
  dueDate     DateTime?
  sortOrder   Int
  createdAt   DateTime              @default(now())

  @@index([checklistId, sortOrder])
}

enum ChecklistCategory {
  PREPARATION
  MATERIALS
  SKILLS
  RESEARCH
  PRACTICE
  LOGISTICS
}

// ============================================
// INSTRUCTOR FEATURES (18-23)
// ============================================

// Feature 18: Co-Instructor Support
model CourseInstructor {
  id           String   @id @default(cuid())
  courseId     String
  course       Course   @relation(fields: [courseId], references: [id])
  instructorId String
  instructor   User     @relation("CoInstructorAssignments", fields: [instructorId], references: [id])
  role         InstructorRole @default(CO_INSTRUCTOR)
  addedAt      DateTime @default(now())

  @@unique([courseId, instructorId])
  @@index([instructorId])
}

enum InstructorRole {
  LEAD
  CO_INSTRUCTOR
  ASSISTANT
}

// Feature 23: Peer Observation
model PeerObservation {
  id           String            @id @default(cuid())
  observerId   String
  observer     User              @relation("ObservationsGiven", fields: [observerId], references: [id])
  observeeId   String
  observee     User              @relation("ObservationsReceived", fields: [observeeId], references: [id])
  courseId     String?
  course       Course?           @relation(fields: [courseId], references: [id])
  scheduledAt  DateTime
  completedAt  DateTime?
  status       ObservationStatus @default(SCHEDULED)
  feedback     String?
  ratings      Json?             // Structured ratings object
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt

  @@index([observerId])
  @@index([observeeId])
  @@index([scheduledAt])
}

enum ObservationStatus {
  SCHEDULED
  COMPLETED
  CANCELLED
}

// ============================================
// INSTRUCTOR FEATURES (24-34)
// ============================================

// Feature 24: Feedback Templates
model FeedbackTemplate {
  id          String   @id @default(cuid())
  instructorId String
  instructor  User     @relation(fields: [instructorId], references: [id])
  title       String
  content     String
  category    String?
  isPublic    Boolean  @default(false)
  usageCount  Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([instructorId])
}

// Feature 26: Session Recap
model SessionRecap {
  id               String            @id @default(cuid())
  sessionId        String            @unique
  attendanceSession AttendanceSession @relation(fields: [sessionId], references: [id])
  instructorId     String
  instructor       User              @relation(fields: [instructorId], references: [id])
  whatCovered      String
  whatWorked       String?
  whatToImprove    String?
  nextSteps        String?
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt

  @@index([instructorId])
}

// Feature 30: Substitute Requests
model SubstituteRequest {
  id           String          @id @default(cuid())
  courseId     String
  course       Course          @relation(fields: [courseId], references: [id])
  requestedById String
  requestedBy  User            @relation("SubstituteRequestsCreated", fields: [requestedById], references: [id])
  sessionDate  DateTime
  reason       String?
  status       SubstituteStatus @default(PENDING)
  assignedToId String?
  assignedTo   User?           @relation("SubstituteRequestsAssigned", fields: [assignedToId], references: [id])
  createdAt    DateTime        @default(now())
  updatedAt    DateTime        @updatedAt

  @@index([courseId])
  @@index([requestedById])
  @@index([status])
}

enum SubstituteStatus {
  PENDING
  ASSIGNED
  CONFIRMED
  COMPLETED
  CANCELLED
}

// Feature 31: Professional Development
model ProfessionalDevelopment {
  id           String    @id @default(cuid())
  instructorId String
  instructor   User      @relation(fields: [instructorId], references: [id])
  title        String
  type         PDType
  provider     String?
  date         DateTime
  hours        Float?
  description  String?
  certificate  String?   // URL to certificate
  createdAt    DateTime  @default(now())

  @@index([instructorId])
  @@index([date])
}

enum PDType {
  CONFERENCE
  WORKSHOP
  COURSE
  WEBINAR
  CERTIFICATION
  OTHER
}

// Feature 32: Curriculum Feedback
model CurriculumFeedback {
  id          String           @id @default(cuid())
  instructorId String
  instructor  User             @relation(fields: [instructorId], references: [id])
  courseId    String?
  course      Course?          @relation(fields: [courseId], references: [id])
  type        FeedbackType
  subject     String
  details     String
  status      FeedbackStatus   @default(SUBMITTED)
  reviewedById String?
  reviewedBy  User?            @relation("CurriculumFeedbackReviewed", fields: [reviewedById], references: [id])
  response    String?
  reviewedAt  DateTime?
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt

  @@index([instructorId])
  @@index([status])
}

enum FeedbackType {
  BUG
  IMPROVEMENT
  NEW_CONTENT
  REMOVAL
  GENERAL
}

enum FeedbackStatus {
  SUBMITTED
  UNDER_REVIEW
  ACCEPTED
  REJECTED
  IMPLEMENTED
}

// Phase 1: Passion Discovery Enums
enum PassionCategory {
  ARTS
  SPORTS
  STEM
  BUSINESS
  SERVICE
  HEALTH_WELLNESS
  TRADES
  ENTERTAINMENT
  WRITING
  MUSIC
  OTHER
}

enum InterestLevel {
  EXPLORING
  DEVELOPING
  ADVANCING
  MASTERING
}

enum QuizType {
  DISCOVERY
  PERSONALITY
  COMPATIBILITY
  LEARNING_STYLE
}

enum SkillLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  EXPERT
}

// Feature 33: Student Spotlight
model StudentSpotlight {
  id           String   @id @default(cuid())
  studentId    String
  student      User     @relation("StudentSpotlights", fields: [studentId], references: [id])
  nominatedById String
  nominatedBy  User     @relation("SpotlightNominations", fields: [nominatedById], references: [id])
  courseId     String?
  course       Course?  @relation(fields: [courseId], references: [id])
  term         String
  reason       String
  achievements String?
  createdAt    DateTime @default(now())

  @@index([studentId])
  @@index([nominatedById])
  @@index([term])
}

// ============================================
// PHASE 1: PASSION DISCOVERY FEATURES
// ============================================

// Passion Areas - Core categories of interests
model PassionArea {
  id          String          @id @default(cuid())
  name        String          @unique
  category    PassionCategory
  description String
  icon        String?
  color       String?         // Hex color for UI
  videoIntroUrl String?       // Try-It session video
  thumbnailUrl String?
  relatedAreaIds String[]     // IDs of related passions
  isActive    Boolean         @default(true)
  order       Int             @default(0)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt

  studentInterests StudentInterest[]
  quizResults     PassionQuizResult[]

  @@index([category])
  @@index([isActive])
}

// Student's interests and progress in passion areas
model StudentInterest {
  id          String        @id @default(cuid())
  studentId   String
  student     User          @relation("StudentPassionInterests", fields: [studentId], references: [id])
  passionId   String
  passion     PassionArea   @relation(fields: [passionId], references: [id])
  level       InterestLevel @default(EXPLORING)
  xpPoints    Int           @default(0)
  currentLevel Int          @default(1)
  startedAt   DateTime      @default(now())
  lastActiveAt DateTime     @default(now())
  isPrimary   Boolean       @default(false) // Is this their main passion?
  notes       String?

  @@unique([studentId, passionId])
  @@index([studentId])
  @@index([passionId])
  @@index([level])
}

// Passion quiz results
model PassionQuizResult {
  id          String      @id @default(cuid())
  studentId   String
  student     User        @relation("PassionQuizResults", fields: [studentId], references: [id])
  quizType    QuizType
  results     Json        // Store detailed quiz data
  topPassionIds String[]  // Top recommended passion area IDs
  scores      Json        // Scores for each passion area
  createdAt   DateTime    @default(now())

  @@index([studentId])
  @@index([quizType])
}

// Gamification: Student XP and levels
model StudentXP {
  id          String   @id @default(cuid())
  studentId   String   @unique
  student     User     @relation("StudentXPProfile", fields: [studentId], references: [id])
  totalXP     Int      @default(0)
  currentLevel Int     @default(1)
  xpToNextLevel Int    @default(100)
  rank        String?  // Overall rank/title
  updatedAt   DateTime @updatedAt

  @@index([totalXP])
  @@index([currentLevel])
}

// XP transactions log
model XPTransaction {
  id          String   @id @default(cuid())
  studentId   String
  student     User     @relation("StudentXPTransactions", fields: [studentId], references: [id])
  amount      Int
  reason      String
  sourceType  String   // "QUIZ", "VIDEO_WATCH", "CHALLENGE", "PRACTICE", "BADGE"
  sourceId    String?
  passionId   String?
  createdAt   DateTime @default(now())

  @@index([studentId])
  @@index([createdAt])
}

// Badges/Achievements
model Badge {
  id          String   @id @default(cuid())
  name        String   @unique
  description String
  icon        String
  category    String   // "DISCOVERY", "PERSISTENCE", "MASTERY", "SOCIAL"
  rarity      String   @default("COMMON") // COMMON, UNCOMMON, RARE, EPIC, LEGENDARY
  xpReward    Int      @default(0)
  criteria    Json     // Criteria to earn
  passionId   String?  // null for general badges
  isActive    Boolean  @default(true)
  order       Int      @default(0)
  createdAt   DateTime @default(now())

  studentBadges StudentBadge[]

  @@index([category])
  @@index([rarity])
}

// Student's earned badges
model StudentBadge {
  id          String   @id @default(cuid())
  studentId   String
  student     User     @relation("StudentBadges", fields: [studentId], references: [id])
  badgeId     String
  badge       Badge    @relation(fields: [badgeId], references: [id])
  earnedAt    DateTime @default(now())
  isPinned    Boolean  @default(false)

  @@unique([studentId, badgeId])
  @@index([studentId])
  @@index([earnedAt])
}

// Quiz questions for discovery
model QuizQuestion {
  id          String   @id @default(cuid())
  quizType    QuizType
  question    String
  questionType String  // "MULTIPLE_CHOICE", "SCALE", "RANKING"
  options     Json?    // For multiple choice
  passionMappings Json // Maps answers to passion areas
  order       Int
  isActive    Boolean  @default(true)

  @@index([quizType])
  @@index([isActive])
}

// Interest connections - which passions work well together
model InterestConnection {
  id          String   @id @default(cuid())
  passion1Id  String
  passion2Id  String
  strength    Float    // 0-1 compatibility score
  description String?
  reasoning   String?  // Why these complement each other

  @@unique([passion1Id, passion2Id])
  @@index([passion1Id])
  @@index([passion2Id])
}

// Hidden Talents Challenges
model TalentChallenge {
  id          String   @id @default(cuid())
  title       String
  description String
  instructions String
  passionIds  String[] // Which passions this might reveal
  difficulty  String   @default("EASY") // EASY, MEDIUM, HARD
  estimatedMinutes Int
  videoUrl    String?
  thumbnailUrl String?
  materialsNeeded String?
  isActive    Boolean  @default(true)
  order       Int      @default(0)
  completions Int      @default(0)

  studentCompletions ChallengeCompletion[]

  @@index([isActive])
}

// Student challenge completions
model ChallengeCompletion {
  id          String   @id @default(cuid())
  studentId   String
  student     User     @relation("ChallengeCompletions", fields: [studentId], references: [id])
  challengeId String
  challenge   TalentChallenge @relation(fields: [challengeId], references: [id])
  completedAt DateTime @default(now())
  enjoymentRating Int? // 1-5
  reflectionText String?
  discoveredPassions String[] // Passion area IDs they might be interested in

  @@unique([studentId, challengeId])
  @@index([studentId])
}

// Try-It Sessions (short intro videos)
model TryItSession {
  id          String   @id @default(cuid())
  passionId   String
  title       String
  description String
  videoUrl    String
  thumbnailUrl String?
  duration    Int      // minutes
  whatYoullLearn String?
  materialsNeeded String?
  presenter   String?  // Name of person in video
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  views       Int      @default(0)
  createdAt   DateTime @default(now())

  watchHistory SessionWatchHistory[]

  @@index([passionId])
  @@index([isActive])
}

// Track video watch history
model SessionWatchHistory {
  id          String   @id @default(cuid())
  studentId   String
  student     User     @relation("SessionWatchHistory", fields: [studentId], references: [id])
  sessionId   String
  session     TryItSession @relation(fields: [sessionId], references: [id])
  watchedAt   DateTime @default(now())
  completed   Boolean  @default(false)
  watchTime   Int      @default(0) // seconds watched
  liked       Boolean?

  @@unique([studentId, sessionId])
  @@index([studentId])
}

// ============================================
// PHASE 2: LEARNING INFRASTRUCTURE
// ============================================

// Skill Trees - Visual progression paths
model SkillTree {
  id          String     @id @default(cuid())
  passionId   String
  name        String
  description String?
  isActive    Boolean    @default(true)
  order       Int        @default(0)
  nodes       SkillNode[]
  createdAt   DateTime   @default(now())

  @@index([passionId])
}

// Individual skills in a skill tree
model SkillNode {
  id            String     @id @default(cuid())
  treeId        String
  tree          SkillTree  @relation(fields: [treeId], references: [id])
  name          String
  description   String
  level         SkillLevel
  prerequisiteIds String[] // IDs of required skills
  xpRequired    Int        @default(0)
  videoUrl      String?
  thumbnailUrl  String?
  resources     Json?      // Links to tutorials, articles
  position      Json       // {x, y} coordinates for visualization
  order         Int        @default(0)

  studentProgress StudentSkillProgress[]

  @@index([treeId])
  @@index([level])
}

// Student progress on individual skills
model StudentSkillProgress {
  id          String     @id @default(cuid())
  studentId   String
  student     User       @relation("StudentSkillProgress", fields: [studentId], references: [id])
  skillNodeId String
  skillNode   SkillNode  @relation(fields: [skillNodeId], references: [id])
  status      String     @default("LOCKED") // "LOCKED", "IN_PROGRESS", "COMPLETED"
  progress    Int        @default(0) // 0-100
  personalBest Json?     // Track best performance/achievement
  startedAt   DateTime?
  completedAt DateTime?
  notes       String?

  @@unique([studentId, skillNodeId])
  @@index([studentId])
  @@index([status])
}

// Micro-learning video modules
model LearningModule {
  id          String   @id @default(cuid())
  passionId   String
  title       String
  description String?
  duration    Int      // minutes
  level       SkillLevel
  videoUrl    String
  thumbnailUrl String?
  transcript  String?
  resources   String[] // Additional resource URLs
  tags        String[]
  viewCount   Int      @default(0)
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())

  watchProgress ModuleWatchProgress[]

  @@index([passionId])
  @@index([level])
  @@index([isActive])
}

// Track student video watch progress
model ModuleWatchProgress {
  id          String   @id @default(cuid())
  studentId   String
  student     User     @relation("ModuleWatchProgress", fields: [studentId], references: [id])
  moduleId    String
  module      LearningModule @relation(fields: [moduleId], references: [id])
  watchTime   Int      @default(0) // seconds watched
  completed   Boolean  @default(false)
  lastWatchedAt DateTime @default(now())
  rating      Int?     // 1-5 stars
  notes       String?

  @@unique([studentId, moduleId])
  @@index([studentId])
}

// Practice session logging
model PracticeLog {
  id          String   @id @default(cuid())
  studentId   String
  student     User     @relation("PracticeLogs", fields: [studentId], references: [id])
  passionId   String
  date        DateTime @default(now())
  duration    Int      // minutes
  activity    String
  skillsFocused String[] // Which skills practiced
  notes       String?
  mood        String?  // "GREAT", "GOOD", "OK", "FRUSTRATED"
  mediaUrls   String[] // Photos/videos of practice
  isPublic    Boolean  @default(false)

  @@index([studentId])
  @@index([passionId])
  @@index([date])
}

// Skill-specific challenges (different from talent discovery challenges)
model SkillChallenge {
  id          String   @id @default(cuid())
  passionId   String
  title       String
  description String
  difficulty  SkillLevel
  instructions String
  estimatedTime Int    // minutes
  successCriteria Json
  videoDemo   String?
  thumbnailUrl String?
  materials   String?  // Materials needed
  resources   String[]
  xpReward    Int      @default(0)
  order       Int      @default(0)
  isActive    Boolean  @default(true)
  completionCount Int  @default(0)

  completions SkillChallengeCompletion[]

  @@index([passionId])
  @@index([difficulty])
  @@index([isActive])
}

// Skill challenge completions
model SkillChallengeCompletion {
  id          String   @id @default(cuid())
  studentId   String
  student     User     @relation("SkillChallengeCompletions", fields: [studentId], references: [id])
  challengeId String
  challenge   SkillChallenge @relation(fields: [challengeId], references: [id])
  completedAt DateTime @default(now())
  timeSpent   Int?     // minutes
  rating      Int?     // 1-5 difficulty rating
  reflection  String?
  mediaUrls   String[]
  xpEarned    Int      @default(0)

  @@unique([studentId, challengeId])
  @@index([studentId])
}

// Learning style assessment
model LearningStyleProfile {
  id          String   @id @default(cuid())
  studentId   String   @unique
  student     User     @relation("LearningStyle", fields: [studentId], references: [id])
  visualScore Int      // 0-100
  auditoryScore Int
  kinestheticScore Int
  readingScore Int
  socialScore Int      // Learn with others
  solitaryScore Int    // Learn alone
  preferences Json     // Detailed preferences and recommendations
  assessedAt  DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

// Resource recommendations
model ResourceRecommendation {
  id          String   @id @default(cuid())
  passionId   String
  title       String
  description String
  url         String
  resourceType String  // "VIDEO", "ARTICLE", "BOOK", "COURSE", "TOOL", "WEBSITE"
  level       SkillLevel
  isFree      Boolean  @default(true)
  rating      Float?
  tags        String[]
  addedBy     String?  // User ID of who added it
  isVerified  Boolean  @default(false)
  createdAt   DateTime @default(now())

  @@index([passionId])
  @@index([resourceType])
  @@index([level])
}

// Technique library
model Technique {
  id          String   @id @default(cuid())
  passionId   String
  name        String
  description String
  level       SkillLevel
  instructions String
  videoUrl    String?
  thumbnailUrl String?
  tips        String?
  commonMistakes String?
  relatedTechniques String[] // IDs of related techniques
  tags        String[]
  viewCount   Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())

  @@index([passionId])
  @@index([level])
  @@index([isActive])
}

// Personal bests / milestones
model PersonalBest {
  id          String   @id @default(cuid())
  studentId   String
  student     User     @relation("PersonalBests", fields: [studentId], references: [id])
  passionId   String
  title       String
  description String?
  value       String   // The achievement (e.g., "3 minutes", "10 paintings")
  unit        String?  // "time", "count", "score"
  previousBest String?
  improvement String?  // Calculated improvement
  achievedAt  DateTime @default(now())
  mediaUrls   String[]
  isPublic    Boolean  @default(false)
  celebrationCount Int @default(0)

  @@index([studentId])
  @@index([passionId])
  @@index([achievedAt])
}

// Cross-skill connections
model SkillConnection {
  id          String   @id @default(cuid())
  skill1      String   // Skill name or passion area
  skill2      String
  connectionType String // "COMPLEMENTARY", "PREREQUISITE", "SIMILAR"
  strength    Float    // 0-1
  explanation String?
  examples    String?

  @@unique([skill1, skill2])
  @@index([skill1])
  @@index([skill2])
}
